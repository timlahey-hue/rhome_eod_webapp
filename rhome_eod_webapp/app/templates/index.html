{% extends "base.html" %}
{% block content %}

<h1>RHome EOD Dashboard</h1>
<p class="muted">Last refresh: {{ now }}</p>

<div class="grid">
  <div class="card">
    <div class="label">Labour $ Today</div>
    <div class="value">{{ fmt_currency(totals.get('labour_cost_today', 0)) }}</div>
  </div>

  <div class="card">
    <div class="label">MTD GM%</div>
    <div class="value">{{ fmt_pct(totals.get('mtd_gm_pct')) }}</div>
  </div>

  <div class="card">
    <div class="label">Revenue Today</div>
    <div class="value">{{ fmt_currency(totals.get('revenue_today', 0)) }}</div>
  </div>

  <div class="card">
    <div class="label">Revenue MTD</div>
    <div class="value">{{ fmt_currency(totals.get('revenue_mtd', 0)) }}</div>
  </div>

  <div class="card">
    <div class="label">Jobs Completed Today</div>
    <div class="value">{{ fmt_num(totals.get('jobs_completed_today', 0)) }}</div>
  </div>
</div>

<hr style="margin:24px 0;" />

<h3>Ingest</h3>
<p class="muted">Click to run a quick ingest probe. This never throws a 500 â€” it will return a JSON result indicating success or exactly what failed.</p>
<p>
  <button id="runIngest">Run Ingest Probe</button>
</p>
<pre id="ingestOut"></pre>

<script>
const btn = document.getElementById('runIngest');
const out = document.getElementById('ingestOut');

btn?.addEventListener('click', async () => {
  out.textContent = 'Running...';
  try {
    const res = await fetch('/ingest/live', { method: 'POST' });
    const data = await res.json();
    out.textContent = JSON.stringify(data, null, 2);
  } catch (e) {
    out.textContent = 'Request failed: ' + e;
  }
});
</script>

{% endblock %}
