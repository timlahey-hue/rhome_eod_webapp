{% extends "base.html" %}
{% block content %}

{% set safe = totals or {} %}

{% if not safe or safe|length == 0 %}
  <p class="sub err">Heads up: no totals found in the database yet. The page still renders, but values are zeroed.</p>
{% endif %}

<div class="cards">
  <div class="card">
    <div class="label">Labour $ Today</div>
    <div class="value">{{ fmt_currency(safe.get('labour_cost_today', 0)) }}</div>
    <div class="sub">from Simpro / eod.db</div>
  </div>

  <div class="card">
    <div class="label">MTD GM%</div>
    <div class="value">{{ fmt_pct(safe.get('mtd_gm_pct', 0)) }}</div>
    <div class="sub">gross margin month-to-date</div>
  </div>

  <div class="card">
    <div class="label">MTD Revenue</div>
    <div class="value">{{ fmt_currency(safe.get('mtd_revenue', 0)) }}</div>
  </div>

  <div class="card">
    <div class="label">MTD Labour</div>
    <div class="value">{{ fmt_currency(safe.get('mtd_labour', 0)) }}</div>
  </div>

  <div class="card">
    <div class="label">MTD Materials</div>
    <div class="value">{{ fmt_currency(safe.get('mtd_materials', 0)) }}</div>
  </div>

  <div class="card">
    <div class="label">MTD Other</div>
    <div class="value">{{ fmt_currency(safe.get('mtd_other', 0)) }}</div>
  </div>
</div>

<div style="margin-top:18px;">
  <form method="post" action="/ingest/live" onsubmit="this.querySelector('button').disabled = true;">
    <button type="submit">Run Live Ingest Probe</button>
    <span class="sub">returns JSON with auth & endpoint discovery</span>
  </form>
</div>

{% endblock %}
